<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tüm Yazılar</title>

<style>
body{
  font-family: Arial, sans-serif;
  margin:0;
  padding:20px;
  background:#f9f9f9;
}
.container{
  max-width:800px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
}
.card{
  padding:15px;
  margin-bottom:12px;
  border:1px solid #ddd;
  border-radius:8px;
}
h3{margin-top:0}
.meta{
  font-size:12px;
  color:#666;
  margin-bottom:5px;
}
a{
  color:#2563eb;
  text-decoration:none;
}
.back-btn{
  background:#eee;
  border:none;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
  margin-bottom:15px;
}
.back-btn:hover{background:#ddd}
button{
  padding:6px 10px;
  margin-left:5px;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">
  <button class="back-btn" onclick="history.back()">← Geri</button>
  <h1>Tüm Yazılar</h1>
  <div id="postsList"></div>
</div>

<script>
const isAdmin = localStorage.getItem('admin') === '1';
const state = JSON.parse(localStorage.getItem('blog_state') || '{"posts":[]}');

function renderPosts(){
  const el = document.getElementById('postsList');
  el.innerHTML = '';

  if(state.posts.length === 0){
    el.innerHTML = '<p>Henüz yazı yok.</p>';
    return;
  }

  state.posts
    .filter(p => isAdmin || p.published)
    .sort((a,b)=> new Date(b.date) - new Date(a.date))
    .forEach(p=>{
      const div = document.createElement('div');
      div.className = 'card';

      div.innerHTML = `
        <h3>
          <a href="post.html?id=${p.id}">${p.title || 'Başlıksız'}</a>
        </h3>
        <div class="meta">
          ${new Date(p.date).toLocaleString()}
          ${!p.published ? '(Taslak)' : ''}
        </div>
      `;

      if(isAdmin){
        const edit = document.createElement('button');
        edit.textContent = 'Düzenle';
        edit.onclick = ()=>location.href=`post.html?id=${p.id}`;

        const del = document.createElement('button');
        del.textContent = 'Sil';
        del.onclick = ()=>{
          if(confirm('Silinsin mi?')){
            state.posts = state.posts.filter(x=>x.id!==p.id);
            localStorage.setItem('blog_state', JSON.stringify(state));
            renderPosts();
          }
        };

        div.append(edit, del);
      }

      el.appendChild(div);
    });
}

renderPosts();
</script>
</body>
</html>
