<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YazÄ±</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#f9f9f9; }
  .container { max-width:800px; margin:auto; background:#fff; padding:20px; border-radius:10px; }
  h1 { margin-top:0; }
  .meta { font-size:12px; color:#666; margin-bottom:10px; }
  img.cover { max-width:100%; height:auto; border-radius:8px; margin-bottom:15px; }
  button { padding:8px 12px; margin-top:10px; cursor:pointer; }
</style>
</head>
<body>
<div class="container">
  <button onclick="goBack()">â† Geri</button>
  <h1 id="postTitle">YazÄ± BaÅŸlÄ±ÄŸÄ±</h1>
  <div class="meta" id="postDate">Tarih</div>
  <img id="postCover" class="cover" src="" alt="Kapak" style="display:none">
  <div id="postContent"></div>
  <div id="editor" style="display:none; margin-top:20px;">
  <hr>
  <h3> YazÄ±yÄ± DÃ¼zenle</h3>

  <input id="editTitle" placeholder="BaÅŸlÄ±k">
  <textarea id="editBody" style="height:300px;"></textarea>

  <input type="file" id="editCover">

  <div style="margin-top:10px;">
    <button onclick="saveEdit(true)">ğŸ’¾ GÃ¼ncelle & YayÄ±nla</button>
    <button onclick="saveEdit(false)">ğŸ“„ Taslak</button>
    <button onclick="deletePost()" style="background:#c53030;color:#fff;">ğŸ—‘ï¸ Sil</button>
  </div>
</div>

  <div id="adminEdit" style="margin-top:15px; display:none">
    <button onclick="editPost()">YazÄ±yÄ± DÃ¼zenle</button>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const postId = params.get('id');
const editMode = params.get('edit') === '1';
let state = JSON.parse(localStorage.getItem('blog_state') || '{}');
let isAdmin = localStorage.getItem('admin')==='1';

function goBack(){ window.history.back(); }

function editPost(){
  // Formu index.html veya admin.htmlâ€™de aÃ§mak iÃ§in 
  // Tekil post silinir ve form doldurulur
  const p = state.posts.find(x=>x.id===postId);
  if(!p){ alert('YazÄ± bulunamadÄ±'); return; }
  localStorage.setItem('editPost', JSON.stringify(p));
  window.location.href='admin.html';
}

function renderPost(){
  if(!state.posts) return;
  const p = state.posts.find(x=>x.id===postId);
  if(!p){
    document.getElementById('postContent').innerHTML='YazÄ± bulunamadÄ±';
    return;
  }

  document.getElementById('postTitle').textContent = p.title;
  document.getElementById('postDate').textContent = new Date(p.date).toLocaleString();
  document.getElementById('postContent').innerHTML = p.body;

  if(p.cover){
    const img = document.getElementById('postCover');
    img.src = p.cover;
    img.style.display='block';
  }

  //  EDIT MODE
  if(isAdmin && editMode){
    document.getElementById('editor').style.display = 'block';
    document.getElementById('editTitle').value = p.title;
    document.getElementById('editBody').value = p.body;
  }
}


renderPost();

function saveEdit(published){
  const p = state.posts.find(x=>x.id===postId);
  if(!p) return alert("YazÄ± bulunamadÄ±");

  p.title = document.getElementById('editTitle').value.trim();
  p.body = document.getElementById('editBody').value.trim();
  p.published = published;
  p.date = new Date().toISOString();

  const coverFile = document.getElementById('editCover').files[0];
  if(coverFile){
    const fr = new FileReader();
    fr.onload = ()=>{
      p.cover = fr.result;
      localStorage.setItem('blog_state', JSON.stringify(state));
      location.reload();
    };
    fr.readAsDataURL(coverFile);
  } else {
    localStorage.setItem('blog_state', JSON.stringify(state));
    location.reload();
  }
}

function deletePost(){
  if(!confirm("Bu yazÄ± silinsin mi?")) return;
  state.posts = state.posts.filter(x=>x.id!==postId);
  localStorage.setItem('blog_state', JSON.stringify(state));
  window.location.href = "posts.html";
}

</script>
</body>
</html>
