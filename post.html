<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YazÄ±</title>

<style>
body{
  font-family: Arial, sans-serif;
  margin:0;
  padding:20px;
  background:#f4f4f4;
}
.container{
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
}
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}
button{
  padding:8px 14px;
  cursor:pointer;
}
.meta{
  font-size:12px;
  color:#666;
  margin-bottom:15px;
}
.normalized-pre{
  white-space: normal !important;
  word-break: break-word !important;
  overflow-wrap: anywhere !important;
  overflow-x: hidden !important;
  max-width: 100%;
}

/* OKUMA MODU */
#postContent{
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
  max-width: 100%;
}
/* GLOBAL: ASLA YATAY SCROLL OLMASIN */
html, body{
  overflow-x: hidden;
}

/* OKUMA + EDÄ°TÃ–R */
#postContent,
#editBody{
  max-width: 100%;
  line-height: 1.7;
  font-size: 17px;

  white-space: normal;
  overflow-wrap: anywhere;
  word-break: break-word;
  overflow-x: hidden;
}

/* PRE / PDF / KOD BLOKLARI */
#postContent pre,
#editBody pre{
  white-space: pre-wrap !important;
  word-break: break-all !important;
  overflow-x: hidden !important;
  max-width: 100%;
}

/* TÃœM Ä°Ã‡ ELEMANLAR */
#postContent *,
#editBody *{
  max-width: 100%;
  box-sizing: border-box;
}

/* UZUN LÄ°NKLER */
#postContent a{
  word-break: break-all;
}
</style>
</head>

<body>
<div class="container">

  <!-- ÃœST BAR -->
  <div class="topbar">
    <button onclick="goBack()">â† Geri</button>
    <button id="editBtn" onclick="enterEditMode()" style="display:none;">âœï¸ YazÄ±yÄ± DÃ¼zenle</button>
  </div>

  <!-- OKUMA MODU -->
  <div id="viewMode">
    <h1 id="postTitle"></h1>
    <div class="meta" id="postDate"></div>
    <div id="postContent"></div>
  </div>

  <!-- DÃœZENLEME MODU -->
  <div id="editMode" style="display:none;">

    <input id="editTitle" placeholder="BaÅŸlÄ±k"
      style="width:100%;font-size:24px;padding:10px;margin-bottom:10px;">

    <!-- TOOLBAR -->
    <div class="toolbar" style="margin-bottom:8px;">
      <button onclick="cmd('bold')"><b>B</b></button>
      <button onclick="cmd('italic')"><i>I</i></button>
      <button onclick="cmd('underline')"><u>U</u></button>
      <button onclick="cmd('insertUnorderedList')">â€¢ Liste</button>
      <button onclick="cmd('insertOrderedList')">1. Liste</button>
      <button onclick="addLink()">ğŸ”— Link</button>
      <button onclick="cmd('formatBlock','h2')">H2</button>
      <button onclick="cmd('removeFormat')">ğŸ§¹ Temizle</button>
    </div>

    <!-- WORD BENZERÄ° EDÄ°TÃ–R -->
    <div id="editBody" contenteditable="true"></div>

    <!-- BUTONLAR -->
    <div style="margin-top:15px;">
      <button onclick="saveEdit(true)">ğŸ’¾ GÃ¼ncelle & YayÄ±nla</button>
      <button onclick="saveEdit(false)">ğŸ“„ Taslak</button>
      <button onclick="deletePost()" style="background:#c53030;color:#fff;">ğŸ—‘ï¸ Sil</button>
      <button onclick="cancelEdit()">âŒ VazgeÃ§</button>
    </div>
  </div>

</div>

<script>
const params = new URLSearchParams(window.location.search);
const postId = params.get('id');

let state = JSON.parse(localStorage.getItem('blog_state') || '{"posts":[]}');
let isAdmin = localStorage.getItem('admin') === '1';

function goBack(){
  window.history.back();
}

/* YAZIYI GÃ–STER */
function renderPost(){
  if(!state.posts) return;

  const p = state.posts.find(x=>x.id===postId);
  if(!p){
    document.getElementById('postContent').innerHTML = 'YazÄ± bulunamadÄ±';
    return;
  }

  document.getElementById('postTitle').textContent = p.title;
  document.getElementById('postDate').textContent = new Date(p.date).toLocaleString();
  const contentEl = document.getElementById('postContent');
  contentEl.innerHTML = p.body;
  normalizeContent(contentEl);


  if(isAdmin){
    document.getElementById('editBtn').style.display = 'inline-block';
  }
}

/* EDIT MODUNA GEÃ‡ */
function enterEditMode(){
  if(!isAdmin) return;

  const p = state.posts.find(x=>x.id===postId);
  const bodyEl = document.getElementById('editBody');
  bodyEl.innerHTML = p.body;
  normalizeContent(bodyEl);


  document.getElementById('viewMode').style.display = 'none';
  document.getElementById('editMode').style.display = 'block';

  document.getElementById('editTitle').value = p.title;
  document.getElementById('editBody').innerHTML = p.body;
}

/* VAZGEÃ‡ */
function cancelEdit(){
  document.getElementById('editMode').style.display = 'none';
  document.getElementById('viewMode').style.display = 'block';
}

/* WORD KOMUTLARI */
function cmd(command, value=null){
  document.execCommand(command, false, value);
}

function addLink(){
  const url = prompt("Link adresi:");
  if(url) document.execCommand("createLink", false, url);
}

/* KAYDET */
function saveEdit(published){
  const p = state.posts.find(x=>x.id===postId);
  if(!p) return alert("YazÄ± bulunamadÄ±");

  p.title = document.getElementById('editTitle').value.trim();
  p.body = document.getElementById('editBody').innerHTML.trim();
  p.published = published;
  p.date = new Date().toISOString();

  localStorage.setItem('blog_state', JSON.stringify(state));
  location.reload();
}

/* SÄ°L */
function deletePost(){
  if(!confirm("Bu yazÄ± silinsin mi?")) return;

  state.posts = state.posts.filter(x=>x.id!==postId);
  localStorage.setItem('blog_state', JSON.stringify(state));
  window.location.href = "posts.html";
}

function normalizeContent(container){
  if(!container) return;

  /* PRE -> DIV */
  container.querySelectorAll('pre').forEach(pre=>{
    const div = document.createElement('div');
    div.innerHTML = pre.innerHTML;
    div.className = 'normalized-pre';
    pre.replaceWith(div);
  });

  /* nowrap / pre TEMÄ°ZLE */
  container.querySelectorAll('*').forEach(el=>{
    const ws = getComputedStyle(el).whiteSpace;
    if(ws === 'nowrap' || ws === 'pre'){
      el.style.whiteSpace = 'normal';
    }
    el.style.wordBreak = 'break-word';
    el.style.overflowWrap = 'anywhere';
    el.style.maxWidth = '100%';
  });

  /* SAF TEXT NODE BÃ–LME (ASIL SORUN BURASI) */
  container.querySelectorAll('*').forEach(el=>{
    el.childNodes.forEach(n=>{
      if(n.nodeType === 3 && n.nodeValue.length > 200){
        n.nodeValue = n.nodeValue.replace(/(.{50})/g, '$1\u200B');
      }
    });
  });
}


renderPost();
</script>
</body>
</html>
